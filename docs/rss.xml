<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[山东大学镜像站]]></title><description><![CDATA[A starter blog demonstrating what Gatsby can do.]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 05 Sep 2021 17:35:09 GMT</lastBuildDate><item><title><![CDATA[镜像站后端配置记录]]></title><description><![CDATA[LXC 容器方案 为什么选择 LXC？ 无论是搭建镜像站，还是其他服务，首要的任务是实现功能，其次是保证稳定，有余力则追求美观。 因此，在单一 Linux…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/blog/BackendConfigJournal/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/blog/BackendConfigJournal/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;h2 id=&quot;lxc-容器方案&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#lxc-%E5%AE%B9%E5%99%A8%E6%96%B9%E6%A1%88&quot; aria-label=&quot;lxc 容器方案 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LXC 容器方案&lt;/h2&gt;
&lt;h3 id=&quot;为什么选择-lxc？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-lxc%EF%BC%9F&quot; aria-label=&quot;为什么选择 lxc？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么选择 LXC？&lt;/h3&gt;
&lt;p&gt;无论是搭建镜像站，还是其他服务，首要的任务是实现功能，其次是保证稳定，有余力则追求美观。&lt;/p&gt;
&lt;p&gt;因此，在单一 Linux 发行版上部署所有服务是十分不明智的做法。例如，激进的发行版提供更多、更新的软件包，而保守的发行版则具有更好的稳定性。此外，在保守发行版上编译安装新程序的做法则显得十分愚蠢——应尽可能选择通过发行版的官方仓库来部署服务，否则稳定性就是无稽之谈。容器级虚拟化就是用来调和两者矛盾的方案。&lt;/p&gt;
&lt;p&gt;为此，我们选择了基于 LXC 的容器方案。LXC 在 2008 年诞生，目的是在共享主机内核的基础上，提供虚拟容器，每个容器运行一个完整的操作系统。与 Docker 相比，一个容器不必仅运行单一服务，因此可根据功能划分容器，便于管理；LXC 主机非常“干净”，除了提供 LXC 管理工具及网络外，无需参与任何具体的任务逻辑，因此具有更强的健壮性——尤其是这台服务器没有 IPMI、没有控制台，唯一的控制方式就是 SSH 时，主机的稳定性就更显得重要了。&lt;/p&gt;
&lt;h3 id=&quot;lxc-主机应该选用什么发行版？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#lxc-%E4%B8%BB%E6%9C%BA%E5%BA%94%E8%AF%A5%E9%80%89%E7%94%A8%E4%BB%80%E4%B9%88%E5%8F%91%E8%A1%8C%E7%89%88%EF%BC%9F&quot; aria-label=&quot;lxc 主机应该选用什么发行版？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LXC 主机应该选用什么发行版？&lt;/h3&gt;
&lt;p&gt;对于 LXC 主机而言，稳定是第一要素。RHEL/CentOS 7 虽然在稳定性方面广受赞誉，但 Linux 3.10 内核与 LXC 1.0 工具集则显得力不从心。理论上，你可以用低版本内核运行原本为高版本内核准备的发行版容器，但实际应用中会导致诸多的小问题，如容器无法开机、DNS 解析发生阻塞等。在经过初步尝试后，RHEL/CentOS 7 确实无法胜任 LXC 主机的角色，被首先排除。CentOS 8 的发布遥遥无期，不做考虑。&lt;/p&gt;
&lt;p&gt;由于 LXC 主机要做的事情很简单，Arch Linux 或许可以保证稳定运行。但过于激进的发行版应放在最后考虑。&lt;/p&gt;
&lt;p&gt;作为老牌 Linux 发行版，Debian 拥有不输 RHEL/CentOS 的稳定性，同时内核较新，是容器级虚拟化的理想选择。截至本文编写时（2019 年 5 月），稳定版对应了搭载 4.9 内核的 Debian 9，而搭载了 4.19 内核的 Debian 10 刚刚进入 RC 阶段，软件包版本已基本冻结。不要因为“非正式版”就将 Debian 10 排除在外，这条可能对于其他发行版适用，但 Debian 即使是 unstable 版本也有不输 Ubuntu 的稳定性。&lt;/p&gt;
&lt;p&gt;由于 4.9 内核搭配高于 4.9 内核的发行版容器时仍会出现 DNS 解析阻塞问题，因此即使 Debian 10 正式发布还需要数月，我们仍然选择了 Debian 10。&lt;/p&gt;
&lt;h3 id=&quot;lxc-容器应该选用什么发行版？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#lxc-%E5%AE%B9%E5%99%A8%E5%BA%94%E8%AF%A5%E9%80%89%E7%94%A8%E4%BB%80%E4%B9%88%E5%8F%91%E8%A1%8C%E7%89%88%EF%BC%9F&quot; aria-label=&quot;lxc 容器应该选用什么发行版？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LXC 容器应该选用什么发行版？&lt;/h3&gt;
&lt;p&gt;容器的发行版主要根据要实现的功能决定。例如，对于 HTTP 服务器，考虑到 TLS 1.3，我们选择了 Debian 10。同步程序以 Python 脚本、rsync 等为主，选择范围较广，我们选择了 Debian 10。对于前端代码，我们选择了 Arch Linux，以便使用最新版的 nodejs 和 yarn 等工具。重复一遍，官方源的软件是最稳定的，其次是可靠的第三方源，而编译安装则是最愚蠢的行为——但 Docker 用户请忽略这句话。&lt;/p&gt;
&lt;h3 id=&quot;lxc-主机的主要配置过程&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#lxc-%E4%B8%BB%E6%9C%BA%E7%9A%84%E4%B8%BB%E8%A6%81%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B&quot; aria-label=&quot;lxc 主机的主要配置过程 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LXC 主机的主要配置过程&lt;/h3&gt;
&lt;h4 id=&quot;安装-debian-10&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-debian-10&quot; aria-label=&quot;安装 debian 10 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 Debian 10&lt;/h4&gt;
&lt;h5 id=&quot;获取镜像&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F&quot; aria-label=&quot;获取镜像 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;获取镜像&lt;/h5&gt;
&lt;p&gt;截至本文编写时（2019 年 5 月），Debian 10 尚未正式发行，因此 Debian 9 的镜像更易获取。虽然每周构建版本的 Debian 10 依然可用，但受限于下载速度，我们选择了先安装 Debian 9 再升级到 Debian 10 的做法。&lt;/p&gt;
&lt;p&gt;注：不知出于何种原因，我们的虚拟机提供方仅愿意预装 CentOS 7——巧妇难为无米之炊。在仅有 SSH 的前提下，我们选择了对最开头 1GiB 的 boot 分区解除挂载，然后将预先制作好的磁盘镜像 dd 到硬盘开头的做法来更换操作系统。但出于方便读者的考虑，在下文的叙述中，仍假设可以直接从光盘安装 Debian。&lt;/p&gt;
&lt;p&gt;将 Debian 的光盘插入服务器，进入安装界面。&lt;/p&gt;
&lt;h5 id=&quot;硬盘分区&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%A1%AC%E7%9B%98%E5%88%86%E5%8C%BA&quot; aria-label=&quot;硬盘分区 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;硬盘分区&lt;/h5&gt;
&lt;p&gt;对系统磁盘分区时，根据服务器是否支持 UEFI 启动，选择 GUID 分区表（GPT）或 MBR 分区表。&lt;/p&gt;
&lt;p&gt;对于 GUID 分区表（GPT），首先创建一个 500 MB 左右的 EFI 系统分区（ESP），格式化为 FAT32（唯一被 UEFI 标准支持的文件系统），挂载到 &lt;code class=&quot;language-text&quot;&gt;/boot/efi&lt;/code&gt;。然后将剩余的空间全部分配给一个主分区，挂载到 &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;对于 MBR 分区表，则可选择将全部的空间分配给一个主分区（设为活动分区），挂载到 &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;。也可选择创建一个 500 MB 左右的主分区（设为活动分区），不格式化，然后将剩余的空间全部分配给一个主分区，挂载到 &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;（不是活动分区）。MBR 分区表的 &lt;code class=&quot;language-text&quot;&gt;扩展分区&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;逻辑分区&lt;/code&gt;的设计是极其糟糕的，因此只需要使用主分区即可。&lt;/p&gt;
&lt;p&gt;注意，均不分配 SWAP 分区。SWAP 分区的优势是保证交换空间在存储设备上的连续性，以便加速访问。然而，对于固态硬盘而言，位置连续没有意义。即便是对于机械硬盘，由于 SWAP 文件一般是在分区基本为空的情况下创建的，只要不改变 SWAP 文件的大小——SWAP 分区本来就做不到这一点——也不会产生碎片。Ubuntu 从 18.04 桌面版开始，默认使用 SWAP 文件代替了 SWAP 分区。因此，在大多数场景下，应使用 SWAP 文件而不是 SWAP 分区。&lt;/p&gt;
&lt;p&gt;对于数据磁盘，一律使用 GUID 分区表。牢记，好习惯是，在一台机器上最多只有一个磁盘是 MBR 分区表，即在服务器不支持 UEFI 启动时系统盘可选择 MBR。除了系统盘外的其他磁盘一律不要使用 MBR 分区表，否则无论是对引导还是分区管理都没有好处。&lt;/p&gt;
&lt;h5 id=&quot;组件选择&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BB%84%E4%BB%B6%E9%80%89%E6%8B%A9&quot; aria-label=&quot;组件选择 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;组件选择&lt;/h5&gt;
&lt;p&gt;不要选择桌面环境。LXC 主机的软件包应尽可能地少，软件包越少，系统越稳定，此外也有利于减少攻击面。记得选择 SSH Server，或者也可以等到后期再安装。&lt;/p&gt;
&lt;h5 id=&quot;安装-grub-引导器&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-grub-%E5%BC%95%E5%AF%BC%E5%99%A8&quot; aria-label=&quot;安装 grub 引导器 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 grub 引导器&lt;/h5&gt;
&lt;p&gt;Debian 安装程序会提示你该将 grub 安装至何处。对于 MBR 分区表，应将 Grub 安装在系统磁盘的活动分区上。（一个 MBR 磁盘上只能有一个或零个活动分区，且活动分区一定是主分区。）对于 GUID 分区表，将其安装在 &lt;code class=&quot;language-text&quot;&gt;EFI 系统分区&lt;/code&gt;（ESP）即可。&lt;/p&gt;
&lt;h5 id=&quot;升级到-debian-10&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8D%87%E7%BA%A7%E5%88%B0-debian-10&quot; aria-label=&quot;升级到 debian 10 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;升级到 Debian 10&lt;/h5&gt;
&lt;p&gt;Debian 的大版本升级很简单，只要将 &lt;code class=&quot;language-text&quot;&gt;/etc/apt/sources.list&lt;/code&gt; 中的发行版代号由 Debian 9 的 &lt;code class=&quot;language-text&quot;&gt;stretch&lt;/code&gt; 替换为 Debian 10 的 &lt;code class=&quot;language-text&quot;&gt;buster&lt;/code&gt;，然后执行 &lt;code class=&quot;language-text&quot;&gt;apt update &amp;amp;&amp;amp; apt dist-upgrade&lt;/code&gt; 即可。中途要注意文件替换的问题，不要无脑 yes，以免配置文件被新版缺省配置文件覆盖。&lt;/p&gt;
&lt;h5 id=&quot;安装基本软件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85%E5%9F%BA%E6%9C%AC%E8%BD%AF%E4%BB%B6&quot; aria-label=&quot;安装基本软件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装基本软件&lt;/h5&gt;
&lt;p&gt;安装以下基本软件。不再单独强调。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;screen&lt;/span&gt; tmux &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;网络配置&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;网络配置 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;网络配置&lt;/h4&gt;
&lt;h5 id=&quot;更换网络管理器为-systemd-networkd&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B4%E6%8D%A2%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%BA-systemd-networkd&quot; aria-label=&quot;更换网络管理器为 systemd networkd permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;更换网络管理器为 systemd-networkd&lt;/h5&gt;
&lt;p&gt;systemd-networkd 是主要适用于有线网络的网络管理器，与 NetworkManager 相比更简单，与传统的网络配置脚本相比更现代化。我们推荐在服务器上使用 systemd-networkd，以便为 LXC 容器提供更简单的网络设置。&lt;/p&gt;
&lt;h6 id=&quot;创建配置文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6&quot; aria-label=&quot;创建配置文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建配置文件&lt;/h6&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/etc/systemd/network&lt;/code&gt; 是 systemd-networkd 的配置文件所在目录。创建一个 &lt;code class=&quot;language-text&quot;&gt;10-wired.network&lt;/code&gt; 文件，内容为：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[Match]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;eth0&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[Network]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;DHCP&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;no&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Address&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;10.102.7.58/23&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Gateway&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;10.102.7.254&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;DNS&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;114.114.114.114&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一目了然，无需多言。&lt;/p&gt;
&lt;h6 id=&quot;禁用-debian-默认的网络管理器&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%A6%81%E7%94%A8-debian-%E9%BB%98%E8%AE%A4%E7%9A%84%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%99%A8&quot; aria-label=&quot;禁用 debian 默认的网络管理器 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;禁用 Debian 默认的网络管理器&lt;/h6&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; /etc/network/interfaces /etc/network/interfaces.bak
systemctl stop networking &lt;span class=&quot;token comment&quot;&gt;# 注意，如果你没有做完上一行就执行了这一行，而且服务器只能通过远程操作，那么你完蛋了&lt;/span&gt;
systemctl disable networking&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;根据安装时选择的软件包不同，NetworkManager 可能也被安装。卸载之。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; remove network-manager&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6 id=&quot;启动-systemd-networkd&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%90%AF%E5%8A%A8-systemd-networkd&quot; aria-label=&quot;启动 systemd networkd permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;启动 systemd-networkd&lt;/h6&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;systemctl start systemd-networkd
systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; systemd-networkd&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6 id=&quot;重启系统以验证设置&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%87%8D%E5%90%AF%E7%B3%BB%E7%BB%9F%E4%BB%A5%E9%AA%8C%E8%AF%81%E8%AE%BE%E7%BD%AE&quot; aria-label=&quot;重启系统以验证设置 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;重启系统以验证设置&lt;/h6&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl &lt;span class=&quot;token function&quot;&gt;reboot&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意，如果配置不正确，SSH 将无法连接。请确保有备用手段可以连接主机。&lt;/p&gt;
&lt;p&gt;在极端情况下，可考虑手动为其分配 IP 地址使其重新联网。假设网络接口名称为 &lt;code class=&quot;language-text&quot;&gt;eth0&lt;/code&gt;，以下命令会相当有用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; a &lt;span class=&quot;token comment&quot;&gt;# 查看 IP 地址&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; r &lt;span class=&quot;token comment&quot;&gt;# 查看路由表&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; n &lt;span class=&quot;token comment&quot;&gt;# 查看 ARP/NDP&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; a &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.0.2/24 dev eth0 &lt;span class=&quot;token comment&quot;&gt;# 为 eth0 分配指定的静态 IP&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; r &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; default via &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.0.1 &lt;span class=&quot;token comment&quot;&gt;# 指定默认路由&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; /etc/resolv.conf &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;nameserver 8.8.8.8&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /etc/resolv.conf &lt;span class=&quot;token comment&quot;&gt;#设置 DNS&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6 id=&quot;使用-systemd-resolved&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-systemd-resolved&quot; aria-label=&quot;使用 systemd resolved permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 systemd-resolved&lt;/h6&gt;
&lt;p&gt;使用与 systemd-networkd 配套的 systemd-resolved 以管理 DNS 地址。&lt;/p&gt;
&lt;p&gt;根据 Debian 版本不同，可能需要手动安装 systemd-resolved 软件包，也可能已经内置在系统中。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; systemd-resolved&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;删除 resolvconf 软件包。我们不使用它管理 DNS 地址。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; remove resolvconf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意，为了避免与后面使用的 dnsmasq 冲突，需要禁用 systemd-networkd 的 DNS 缓存功能。此外，由于众所周知的原因，不能强制使用 DNSSEC。&lt;/p&gt;
&lt;p&gt;修改 &lt;code class=&quot;language-text&quot;&gt;/etc/systemd/resolved.conf&lt;/code&gt; 文件，设置以下选项：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[Resolve]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;no&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;DNSStubListener&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;no&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;DNSSEC&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;allow-downgrade&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;启动 systemd-resolved，并配置好 DNS。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; systemd-resolved
systemctl start systemd-resolved
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; /etc/resolv.conf
&lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -s /run/systemd/resolve/resolv.conf /etc/resolv.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6 id=&quot;为-lxc-提供网桥和-nat&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA-lxc-%E6%8F%90%E4%BE%9B%E7%BD%91%E6%A1%A5%E5%92%8C-nat&quot; aria-label=&quot;为 lxc 提供网桥和 nat permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为 LXC 提供网桥和 NAT&lt;/h6&gt;
&lt;p&gt;创建 &lt;code class=&quot;language-text&quot;&gt;20-lxc-bridge.netdev&lt;/code&gt; 文件，内容如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[NetDev]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;lxc-bridge&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Kind&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;bridge&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建 &lt;code class=&quot;language-text&quot;&gt;20-lxc-bridge.network&lt;/code&gt;文件，内容如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[Match]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;lxc-bridge&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[Network]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Address&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;192.168.0.1/24&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;IPForward&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;ipv4&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;IPMasquerade&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;yes&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;DHCPServer&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;yes&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[DHCPServer]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;EmitDNS&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;yes&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;DNS&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;192.168.0.1&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;PoolOffset&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;100&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;PoolSize&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;100&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建&lt;code class=&quot;language-text&quot;&gt;20-lxc-dummy.netdev&lt;/code&gt;文件，内容如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[NetDev]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;lxc-dummy&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Kind&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;dummy&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建&lt;code class=&quot;language-text&quot;&gt;20-lxc-dummy.network&lt;/code&gt;文件，内容如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[Match]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;lxc-dummy&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[Network]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Bridge&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;lxc-bridge&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如此，名为 &lt;code class=&quot;language-text&quot;&gt;lxc-bridge&lt;/code&gt; 的网桥如同路由器的 LAN 口，接入的设备可自动获取 IP 并上网。&lt;/p&gt;
&lt;p&gt;注意，这里我们将 &lt;code class=&quot;language-text&quot;&gt;192.168.0.1&lt;/code&gt; 作为了 DNS 服务器，但此时还没有架设它。一会儿将解决这个问题。&lt;/p&gt;
&lt;p&gt;由于 LXC 容器要提供服务，端口转发是必备的，因此防火墙是必不可少的。&lt;/p&gt;
&lt;h5 id=&quot;安装-firewalld-防火墙&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-firewalld-%E9%98%B2%E7%81%AB%E5%A2%99&quot; aria-label=&quot;安装 firewalld 防火墙 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 firewalld 防火墙&lt;/h5&gt;
&lt;p&gt;Debian 10 已将 iptables 更换为 nftables。但我们并不手动配置这些 *tables，而是使用 firewalld 作为防火墙。firewalld 可以认为是 *tables 的前端。&lt;/p&gt;
&lt;p&gt;注意，一旦安装了 firewalld，之前在 systemd-networkd 中设置的 NAT 转发会作废，而 DHCP 服务也会被阻断。一会儿将解决这些问题。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; firewalld
systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; firewalld
systemctl start firewalld&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;缺省情况下，SSH 服务已被放行。&lt;/p&gt;
&lt;h6 id=&quot;将后端切换为-nftables&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B0%86%E5%90%8E%E7%AB%AF%E5%88%87%E6%8D%A2%E4%B8%BA-nftables&quot; aria-label=&quot;将后端切换为 nftables permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;将后端切换为 nftables&lt;/h6&gt;
&lt;p&gt;依据发行版不同，firewalld 可能使用 iptables 或 nftables 做后端。推荐使用 nftables 做后端。&lt;/p&gt;
&lt;p&gt;nftables 可能没有被安装。首先安装。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; nftables&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;打开 &lt;code class=&quot;language-text&quot;&gt;/etc/firewalld/firewalld.conf&lt;/code&gt; 文件，找到并设置以下选项。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# FirewallBackend&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Selects the firewall backend implementation.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Choices are:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#	- nftables (default)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#	- iptables (iptables, ip6tables, ebtables and ipset)&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;FirewallBackend&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;nftables&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果之前设置为了 iptables，将其改为 nftables。修改后，可能需要重启主机才能完全生效。&lt;/p&gt;
&lt;p&gt;在 Debian 10 的软件包中，firewalld 依然依赖 iptables。不过，修改了配置文件并重启后，iptables 不做任何用途使用。&lt;code class=&quot;language-text&quot;&gt;iptables -L&lt;/code&gt; 的输出结果应该是空。不需要管它。&lt;/p&gt;
&lt;h6 id=&quot;配置外网&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE%E5%A4%96%E7%BD%91&quot; aria-label=&quot;配置外网 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置外网&lt;/h6&gt;
&lt;p&gt;将外网接口 &lt;code class=&quot;language-text&quot;&gt;eth0&lt;/code&gt; 接入 external 区域。此区域将作为 NAT 的出口，以及端口转发。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;external --add-interface&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;eth0 --permanent
firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;external --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ssh --permanent &lt;span class=&quot;token comment&quot;&gt;# 这条应该默认存在，不过再写一次&lt;/span&gt;

firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;external --add-masquerade --permanent
firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;external --add-forward-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9002&lt;/span&gt;:proto&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp:toport&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:toaddr&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.0.2 --permanent
firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;external --add-forward-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:proto&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp:toport&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:toaddr&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.0.2 --permanent
firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;external --add-forward-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;:proto&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp:toport&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;:toaddr&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.0.2 --permanent

firewall-cmd --reload&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意，因为 firewalld 服务已经开启，如果这里没有设置 &lt;code class=&quot;language-text&quot;&gt;--add-masquerade&lt;/code&gt;，systemd-networkd 中设置的 &lt;code class=&quot;language-text&quot;&gt;IPMasquerade=yes&lt;/code&gt; 无效。另外，不要搞混在哪里设置 masquerade。对于 firewalld，在 NAT 的出口设置 masquerade；对于 systemd-networkd，在 NAT 的入口设置 masquerade。&lt;/p&gt;
&lt;h6 id=&quot;配置内网&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%91&quot; aria-label=&quot;配置内网 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置内网&lt;/h6&gt;
&lt;p&gt;将内网 &lt;code class=&quot;language-text&quot;&gt;lxc-bridge&lt;/code&gt; 接入 internal 区域。此区域将被配置为类似于路由器的 LAN。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;internal --add-interface&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;lxc-bridge --permanent
firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;internal --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dhcp --permanent
firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;internal --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dns --permanent

firewall-cmd --reload&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6 id=&quot;重要提示&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%87%8D%E8%A6%81%E6%8F%90%E7%A4%BA&quot; aria-label=&quot;重要提示 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;重要提示&lt;/h6&gt;
&lt;p&gt;必须为 &lt;code class=&quot;language-text&quot;&gt;lxc-bridge&lt;/code&gt; 分配到一个不同于 external 区域之外的区域，而绝不可以接入到 external 区域（因为我们在 external 区域上设置了 masquerade）。&lt;/p&gt;
&lt;p&gt;如果主机上还有其他网卡，请根据网卡的角色手动为其指定一个区域。默认情况下，未指定区域的网卡将被接入 public 区域。作为外网使用的网卡应接入之前配置好的 external 区域。&lt;/p&gt;
&lt;h5 id=&quot;安装-dns-服务器&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-dns-%E6%9C%8D%E5%8A%A1%E5%99%A8&quot; aria-label=&quot;安装 dns 服务器 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 DNS 服务器&lt;/h5&gt;
&lt;p&gt;这里的 DNS 服务器是为了缓存 DNS 解析结果，因此使用 dnsmasq。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; dnsmasq&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编辑 &lt;code class=&quot;language-text&quot;&gt;/etc/dnsmasq.conf&lt;/code&gt; 文件，内容改为：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;no-resolv
&lt;span class=&quot;token constant&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;114.114.114.114&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;lxc-bridge&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果希望使用 &lt;code class=&quot;language-text&quot;&gt;/etc/resolv.conf&lt;/code&gt; 的 DNS 服务器设置，则文件内容只需要这一行：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;lxc-bridge&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;启动 dnsmasq 服务。注意，如果启动失败，使用 &lt;code class=&quot;language-text&quot;&gt;ss -unlp&lt;/code&gt; 命令检查是否有其他程序占用了 UDP 53 端口。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; dnsmasq
systemctl start dnsmasq&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;使用-lxc-30&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-lxc-30&quot; aria-label=&quot;使用 lxc 30 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 LXC 3.0&lt;/h4&gt;
&lt;p&gt;Debian 9 搭配的是 LXC 2.0，而 Debian 10 搭配的是 LXC 3.0。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; lxc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5 id=&quot;创建一个名为-name-的容器&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BA-name-%E7%9A%84%E5%AE%B9%E5%99%A8&quot; aria-label=&quot;创建一个名为 name 的容器 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建一个名为 NAME 的容器&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;lxc-create -n NAME -t download -- --server mirrors.tuna.tsinghua.edu.cn/lxc-images --keyserver&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;hkp://keyserver.ubuntu.com:80&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2019 年 5 月注：这里使用了清华大学开源软件镜像站作为 lxc-images 的上游仓库。但是截至目前，清华大学开源软件镜像站的 lxc-images 存在严重的索引提前于内容同步完成的情况，因此如果报错 404，请将 &lt;code class=&quot;language-text&quot;&gt;--server mirrors.tuna.tsinghua.edu.cn/lxc-images&lt;/code&gt; 部分删除，使用官方源。&lt;/p&gt;
&lt;p&gt;2019 年 12 月注：截至目前，清华大学开源软件镜像站的 lxc-images 依然存在严重的索引提前于内容同步完成的情况。山东大学镜像站已提供 lxc-images 的&lt;a href=&quot;/docs/guide/lxc-images.html&quot;&gt;可靠镜像&lt;/a&gt;。可改为以下命令。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;lxc-create -n NAME -t download -- --server mirrors.sdu.edu.cn/lxc-images --no-validate&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5 id=&quot;启停容器、进入容器&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%90%AF%E5%81%9C%E5%AE%B9%E5%99%A8%E3%80%81%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8&quot; aria-label=&quot;启停容器、进入容器 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;启停容器、进入容器&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;lxc-start -n NAME
lxc-attach -n NAME&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意，如果你使用的是 LXC 1.0，这里的命令有所不同，不再赘述。&lt;/p&gt;
&lt;p&gt;进入容器后，可以发现未分配网络。因此，按 Ctrl+D 退出容器，然后用以下命令建议容器退出。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;lxc-stop -n NAME&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5 id=&quot;为容器分配网络、共享文件夹、自动启动&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E5%AE%B9%E5%99%A8%E5%88%86%E9%85%8D%E7%BD%91%E7%BB%9C%E3%80%81%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9%E3%80%81%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8&quot; aria-label=&quot;为容器分配网络、共享文件夹、自动启动 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为容器分配网络、共享文件夹、自动启动&lt;/h5&gt;
&lt;p&gt;编辑 &lt;code class=&quot;language-text&quot;&gt;/var/lib/lxc/NAME/config&lt;/code&gt; 文件，最后两行应该像这样。（早期版本的 LXC 与此略有不同。）&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Network configuration&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.net.0.type&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; empty&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将其改为&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Network configuration&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.net.0.type&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; veth&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.net.0.link&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; lxc-bridge&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.net.0.flags&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; up&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.net.0.hwaddr&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; 00:16:3e:xx:xx:xx&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Autostart&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.start.auto&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; 1&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.start.delay&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; 0&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.start.order&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; 0&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Mount&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;lxc.mount.entry&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; /path/to/folder1 path/to/folder2 none bind 0 0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;即可实现相应的配置。&lt;/p&gt;
&lt;p&gt;请注意挂载文件夹的写法。这将把主机的 &lt;code class=&quot;language-text&quot;&gt;/path/to/folder1&lt;/code&gt; 文件夹与容器内的 &lt;code class=&quot;language-text&quot;&gt;/path/to/folder2&lt;/code&gt; 文件夹联通。容器内该文件夹必须事先存在，否则会报错。换句话说，记得在主机事先创建好 &lt;code class=&quot;language-text&quot;&gt;/var/lib/lxc/NAME/rootfs/path/to/folder2&lt;/code&gt; 文件夹。&lt;/p&gt;
&lt;h5 id=&quot;示例：容器内开启-ssh&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AE%B9%E5%99%A8%E5%86%85%E5%BC%80%E5%90%AF-ssh&quot; aria-label=&quot;示例：容器内开启 ssh permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;示例：容器内开启 SSH&lt;/h5&gt;
&lt;p&gt;首先，尽管主机已经开启了 DHCP 服务，应当使用静态 IP 来配置容器，这样才能和之前在 firewalld 中配置好的端口转发规则一致。假设之前在主机内设置了 &lt;code class=&quot;language-text&quot;&gt;firewall-cmd --zone=public --add-forward-port=port=9002:proto=tcp:toport=22:toaddr=192.168.0.2&lt;/code&gt;，则将容器内的 IP 设置为 &lt;code class=&quot;language-text&quot;&gt;192.168.0.2&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;后，直接安装 SSH 服务器即可从主机的 9002 端口访问 SSH。同样，在容器内推荐使用 systemd-networkd 来配置网络。&lt;/p&gt;
&lt;h4 id=&quot;lxc-主机的其他配置&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#lxc-%E4%B8%BB%E6%9C%BA%E7%9A%84%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;lxc 主机的其他配置 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;LXC 主机的其他配置&lt;/h4&gt;
&lt;p&gt;以下配置与 LXC 方案无关，仅为推荐。&lt;/p&gt;
&lt;h5 id=&quot;安装-molly-guard&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-molly-guard&quot; aria-label=&quot;安装 molly guard permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 molly-guard&lt;/h5&gt;
&lt;p&gt;此软件包可避免人为疏忽而意外关闭或重启宿主服务器。使用 &lt;code class=&quot;language-text&quot;&gt;lxc-attach&lt;/code&gt; 在主机上操作容器时，以为在操作容器实际上却操作了主机是很常见的失误。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; molly-guard&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可顺便将主机名更改为有意义的名称，如 &lt;code class=&quot;language-text&quot;&gt;lxc-host&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;hostnamectl set-hostname lxc-host&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5 id=&quot;安装-haveged&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-haveged&quot; aria-label=&quot;安装 haveged permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 haveged&lt;/h5&gt;
&lt;p&gt;虚拟机更容易出现熵不足的问题。比如，是否开机后 SSH 连接一直超时，然后从控制台登录后 SSH 连接又突然好了？这种情况很可能是熵不足。haveged 通过使用质量较低的伪随机数填充系统的熵池，达到加速 &lt;code class=&quot;language-text&quot;&gt;/dev/random&lt;/code&gt; 的目的，从而避免熵不足的问题。仅当安全不是首要考虑因素时，才应使用该软件，否则应将硬件随机数发生器直通到虚拟机内部。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; haveged
systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; haveged
systemctl start haveged&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意，提供随机数是内核的事情，因此只能在主机上做这个事情。&lt;/p&gt;
&lt;h5 id=&quot;创建-swap-文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA-swap-%E6%96%87%E4%BB%B6&quot; aria-label=&quot;创建 swap 文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建 SWAP 文件&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;假设 SWAP 文件的大小为 10 GiB。创建一个大小为 10GiB 的全零文件。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;dd if=/dev/zero of=/data/swapfile bs=1M count=10240&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;  *对于 XFS 或 F2FS 文件系统，请确保创建全零文件，而不是使用 fallocate 或者 dd 等创建稀疏文件。不然可能无法 mkswap 和 swapon。见 &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1129205#c3&quot;&gt;Bug 1129205 - fallocate to create swap file creates a file with holes&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;  &lt;em&gt;如非必要，不要随便使用 dd 等命令生成空的大文件。尽可能产生稀疏文件以节约时间和保护 SSD 寿命。本处为不得已而为之。&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;确保该文件的所有者和组均为 root。&lt;/li&gt;
&lt;li&gt;将其权限置为 600。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;chmod 600 /data/swapfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;格式化并临时启用该交换文件。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;mkswap /data/swapfile &amp;amp;&amp;amp; swapon /data/swapfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;确保 SWAP 生效。检查以下命令返回的结果中的 Swap 一行的值是否增加了。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;free -h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;6&quot;&gt;
&lt;li&gt;修改 /etc/fstab。在最后增加一行&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;/data/swapfile none swap defaults 0 0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;  &lt;em&gt;确保 /data 的挂载在该行之前出现。&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&quot;7&quot;&gt;
&lt;li&gt;重启系统，再用 free 命令查看 SWAP 是否生效。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;systemctl reboot
free -h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5 id=&quot;加速-ssh-登录&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8A%A0%E9%80%9F-ssh-%E7%99%BB%E5%BD%95&quot; aria-label=&quot;加速 ssh 登录 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;加速 SSH 登录&lt;/h5&gt;
&lt;p&gt;默认配置的 SSH 服务会对客户端 IP 做一些检查，如 DNS 反向解析、GSS 认证，非常耗时。建议关闭。
打开 &lt;code class=&quot;language-text&quot;&gt;/etc/ssh/sshd_config&lt;/code&gt; 文件，找到并设置以下选项。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;UseDNS no
GSSAPIAuthentication no&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启 SSH 服务。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;systemctl restart sshd&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;镜像同步方案&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%95%9C%E5%83%8F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88&quot; aria-label=&quot;镜像同步方案 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;镜像同步方案&lt;/h2&gt;
&lt;h3 id=&quot;工具选择&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9&quot; aria-label=&quot;工具选择 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;工具选择&lt;/h3&gt;
&lt;p&gt;镜像站同步的内容大致分为两类：一类是完全同步的仓库，如 Arch Linux 源；一类是需要选择性同步的仓库，如 Debian、Ubuntu 源等，受镜像站容量限制，只同步 amd64 指令集的二进制程序。&lt;/p&gt;
&lt;p&gt;对于前者，rsync 通常是最合适的选择。&lt;/p&gt;
&lt;p&gt;对于后者，我们选择并改进了 apt-mirror 工具，该工具提供了选择性同步功能，并实现了同步的原子性。&lt;/p&gt;
&lt;h3 id=&quot;原子性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8E%9F%E5%AD%90%E6%80%A7&quot; aria-label=&quot;原子性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;原子性&lt;/h3&gt;
&lt;p&gt;仓库由索引文件和资源文件组成，这些文件需要保持一致。&lt;/p&gt;
&lt;p&gt;镜像站必须达到如下目标。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;镜像站的状态&lt;/th&gt;
&lt;th&gt;版本1&lt;/th&gt;
&lt;th&gt;版本1升级到版本2&lt;/th&gt;
&lt;th&gt;版本2&lt;/th&gt;
&lt;th&gt;版本2升级到版本3&lt;/th&gt;
&lt;th&gt;版本3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;用户访问的内容&lt;/td&gt;
&lt;td&gt;版本1&lt;/td&gt;
&lt;td&gt;版本1&lt;/td&gt;
&lt;td&gt;版本2&lt;/td&gt;
&lt;td&gt;版本2&lt;/td&gt;
&lt;td&gt;版本3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;即，进行同步时，镜像站需要保留新旧两个版本的内容，并在同步结束时，以非常快的速度完成版本切换。只有这样，才能保证用户使用时不会出错。想象一下，一本书，前一半页码是第1版第1次印刷的内容，后一半则变成了第1版第2次印刷的内容，这样的书显然是无法阅读的。&lt;/p&gt;
&lt;p&gt;apt-mirror 工具已经做好了原子性的工作。&lt;/p&gt;
&lt;p&gt;rsync 虽然也有 &lt;code class=&quot;language-text&quot;&gt;--delay-updates&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;--delete-after&lt;/code&gt; 这样的选项，但从实际体验来看效果并不好，因此，我们姑且认为 rsync 不具备原子性，亲自完成保证原子性的工作。&lt;/p&gt;
&lt;h3 id=&quot;保证原子性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BF%9D%E8%AF%81%E5%8E%9F%E5%AD%90%E6%80%A7&quot; aria-label=&quot;保证原子性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;保证原子性&lt;/h3&gt;
&lt;h4 id=&quot;引子&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BC%95%E5%AD%90&quot; aria-label=&quot;引子 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;引子&lt;/h4&gt;
&lt;p&gt;在这之前，我们来探究一个小问题。&lt;/p&gt;
&lt;p&gt;假设磁盘上存在一个文件 &lt;code class=&quot;language-text&quot;&gt;/path/to/file&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;不考虑文件权限等问题，只从文件内容的角度来说，以下两行 bash 命令是否等价？&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /path/to/file&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将空内容写入到该文件中。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;rm /path/to/file &amp;amp;&amp;amp; touch /path/to/file&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;删除该文件，并重建一个空文件。&lt;/p&gt;
&lt;p&gt;看起来，&lt;code class=&quot;language-text&quot;&gt;/path/to/file&lt;/code&gt; 的内容均被清空，似乎是等价的。然而，并不是这样。运行并观察下面的两段代码。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;foo&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /tmp/file1
&lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -sf /tmp/file1 /tmp/file2
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /tmp/file2
&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /tmp/file1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;foo&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /tmp/file1
&lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -sf /tmp/file1 /tmp/file2
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; /tmp/file2 &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; /tmp/file2
&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /tmp/file1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;第一段代码，随着&lt;code class=&quot;language-text&quot;&gt;file2&lt;/code&gt; 被清空，&lt;code class=&quot;language-text&quot;&gt;file1&lt;/code&gt;  也同时被清空了。&lt;/p&gt;
&lt;p&gt;第二段代码，&lt;code class=&quot;language-text&quot;&gt;file1&lt;/code&gt; 并没有被清空，因为在删除 &lt;code class=&quot;language-text&quot;&gt;file2&lt;/code&gt; 这个文件时，它与 &lt;code class=&quot;language-text&quot;&gt;file1&lt;/code&gt; 的关系被解除了。&lt;/p&gt;
&lt;p&gt;PS: 为什么有那么多人认为“Linux 的软链接如同 Windows 的快捷方式”？谬论重复一千遍，也不能变为真理，但是还真有一群傻瓜认为这句话正确，原因仅仅是因为大家都这么说。真正正确的说法是，“Linux 的软链接如同 Windows 的软链接；Linux 的 .desktop 文件如同 Windows 的快捷方式”。&lt;/p&gt;
&lt;h4 id=&quot;冗余，似乎是必要的代价？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%86%97%E4%BD%99%EF%BC%8C%E4%BC%BC%E4%B9%8E%E6%98%AF%E5%BF%85%E8%A6%81%E7%9A%84%E4%BB%A3%E4%BB%B7%EF%BC%9F&quot; aria-label=&quot;冗余，似乎是必要的代价？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;冗余，似乎是必要的代价？&lt;/h4&gt;
&lt;p&gt;原子性，可用以下流程表示。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一步：通过魔法，提供一个目录A的副本，记为目录B。&lt;/li&gt;
&lt;li&gt;第二步：用户或者程序改动目录B。&lt;/li&gt;
&lt;li&gt;第三步：通过魔法，用目录B代替目录A。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;通过以上的步骤，可以保证目录A始终保持一致性。如同显卡的双缓冲机制一样，下一个场景完全准备好了，才能替换上一个场景，以避免画面闪烁的情况，也就是不一致性。&lt;/p&gt;
&lt;p&gt;那么，如何实现步骤中的魔法呢？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;方法一：复制&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;效率：低。浪费磁盘空间和复制的时间。&lt;/li&gt;
&lt;li&gt;是否保证了原子性：是。&lt;/li&gt;
&lt;li&gt;例子：git——用户可以对当前工作区的文件做任何修改，然后 commit 或者 revert。为了保证已经 commit 的数据不丢失，复制一份是必须的。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;方法二：链接&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;方法：链接。硬链接、软链接都行。&lt;/li&gt;
&lt;li&gt;效率：高。没有浪费磁盘空间，不需要复制。&lt;/li&gt;
&lt;li&gt;是否保证了原子性：&lt;strong&gt;否&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;这是一个不可行的办法。原因很简单，对目录B内文件的操作可以反过来对目录A的文件造成影响。还记得刚才的引子吗？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;你还能想到其他的方法吗？&lt;/p&gt;
&lt;p&gt;很遗憾，如果没有其他魔法的支持，复制就是唯一的办法。&lt;/p&gt;
&lt;h4 id=&quot;cow-aka-写时复制&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cow-aka-%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6&quot; aria-label=&quot;cow aka 写时复制 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;COW (aka. 写时复制)&lt;/h4&gt;
&lt;p&gt;btrfs 和 ZFS 文件系统都支持 COW。COW 的意思是，将文件A复制到文件B时，暂时不执行复制动作，而是让两个文件共用一份存储空间。当文件A或B发生改动时，执行复制动作，将两个文件分开。&lt;/p&gt;
&lt;p&gt;COW 就是文件系统提供的“魔法”。很显然，COW 只能由文件系统提供支持。&lt;/p&gt;
&lt;p&gt;cp 命令提供了 COW 的支持，使用 &lt;code class=&quot;language-text&quot;&gt;--reflink&lt;/code&gt; 选项控制。例如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; --reflink&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;always /path/to/fileA /path/to/fileB&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;强制使用 COW 进行复制。失败则报错。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; --reflink&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;auto /path/to/fileA /path/to/fileB&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;首先尝试 COW 进行复制，失败则会 fallback 到普通复制。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; --reflink&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;never /path/to/fileA /path/to/fileB&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;强制使用普通复制。&lt;/p&gt;
&lt;p&gt;将 COW 与普通复制、链接相提并论并不合适，因为 COW 和普通复制的效果一样——产生了一个与母本毫无联系的副本。在用户的眼中，COW 和普通复制是等价的。当然，在系统管理员眼中，COW 节约了时间和空间。&lt;/p&gt;
&lt;h4 id=&quot;依赖-cow-的原子性脚本&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BE%9D%E8%B5%96-cow-%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;依赖 cow 的原子性脚本 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;依赖 COW 的原子性脚本&lt;/h4&gt;
&lt;p&gt;有了 COW，我们可以有效率地保证原子性了。参考如下的脚本。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/usr/bin/env bash&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 要保证原子性的目录路径，实际上为软链接，在脚本执行前指向 ${DIR_CURRENT}&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;DIR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path/to/dir
&lt;span class=&quot;token comment&quot;&gt;# 当前版本的文件&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;DIR_CURRENT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path/to/dir-current
&lt;span class=&quot;token comment&quot;&gt;# 临时目录，用来存储下一版本的文件&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;DIR_NEW&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path/to/dir-new

&lt;span class=&quot;token comment&quot;&gt;# 加锁，保证此脚本不会多次执行。此部分略去。&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 将 ${DIR_CURRENT} 复制到 ${DIR_NEW}。强制使用 COW。&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; --reflink&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_CURRENT}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_NEW}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 执行用户程序，对 ${DIR_NEW} 做任何事情。&lt;/span&gt;
/path/to/some/dirty/work/here &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_NEW}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 将软链接指向 ${DIR_NEW}，即切换到新版本。&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -sf &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_NEW}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 用 ${DIR_NEW} 取代 ${DIR_CURRENT}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_CURRENT}&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; --reflink&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;always &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_NEW}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_CURRENT}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 将软链接指向 ${DIR_CURRENT}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -sf &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_CURRENT}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR}&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${DIR_NEW}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 完成&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在如上的脚本中，DIR 目录始终保持了原子性。目的达到了。&lt;/p&gt;
&lt;h3 id=&quot;systemd-的-service-和-timer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#systemd-%E7%9A%84-service-%E5%92%8C-timer&quot; aria-label=&quot;systemd 的 service 和 timer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;systemd 的 service 和 timer&lt;/h3&gt;
&lt;p&gt;镜像站需要定期执行同步任务。我们不使用老旧的 corntab，而是将同步任务作为 systemd 的服务，并配置合适的定时器来定期执行。举例如下。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/etc/systemd/system/example-task.service&lt;/code&gt; 文件如下。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[Unit]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;Example Task&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;network.target&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Wants&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;network.target&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[Service]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;simple&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;/path/to/example/task&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Restart&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;no&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[Install]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;multi-user.target&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/etc/systemd/system/example-task.timer&lt;/code&gt;文件如下。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[Unit]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;Timer for Example Task&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[Timer]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;OnCalendar&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;*-*-* 17:00:00 UTC&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;example-task.service&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;[Install]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;timers.target&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如图所示的定时器会在协调世界时 17 点时启动对应的服务。如果该服务执行的太慢，以至于 24 小时后依然没有结束，那么定时器不会重复启动该服务的第二个实例。&lt;/p&gt;
&lt;p&gt;PS: Linux 中的&lt;code class=&quot;language-text&quot;&gt;格林尼治时间&lt;/code&gt;指&lt;strong&gt;格林尼治这个地区的时区&lt;/strong&gt;，而不是零时区——别忘了，英国实行夏时制。因此，为了消除歧义，无论是与他人交谈时还是在计算机世界中，永远不使用 &lt;code class=&quot;language-text&quot;&gt;格林尼治时间&lt;/code&gt; 一词，也不要将时区设置为 &lt;code class=&quot;language-text&quot;&gt;Etc/Greenwich&lt;/code&gt;。将服务器的时区设置为 &lt;code class=&quot;language-text&quot;&gt;协调世界时&lt;/code&gt; 即 &lt;code class=&quot;language-text&quot;&gt;Etc/Utc&lt;/code&gt; 是个好习惯。&lt;/p&gt;
&lt;p&gt;不要忘了将定时器设置为开机自启，并启动之。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl daemon-reload
systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; example-task.timer
systemctl start example-task.timer&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;更多的配置选项可参考 systemd 的文档，不再赘述。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[一个镜像站的诞生]]></title><description><![CDATA[正逢学校虚拟化平台建设时机，山东大学 oops 计算机社团和网管会向山东大学信息办提出建设山东大学镜像站的申请。得到信息办郭晓东老师、孙凤超老师和一线工程师的支持和帮助，自此镜像站正式起步。 配置 在镜像站发展初期，学校提供了以下虚拟硬件资源： 处理器：4 vCPU 内存：…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/blog/BirthOfYetAnotherMirrorSite/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/blog/BirthOfYetAnotherMirrorSite/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;正逢学校虚拟化平台建设时机，山东大学 oops 计算机社团和网管会向山东大学信息办提出建设山东大学镜像站的申请。得到信息办郭晓东老师、孙凤超老师和一线工程师的支持和帮助，自此镜像站正式起步。&lt;/p&gt;
&lt;h2 id=&quot;配置&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;配置 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置&lt;/h2&gt;
&lt;p&gt;在镜像站发展初期，学校提供了以下虚拟硬件资源：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;处理器：4 vCPU&lt;/li&gt;
&lt;li&gt;内存：4 GB&lt;/li&gt;
&lt;li&gt;硬盘：50GB + 1TB&lt;/li&gt;
&lt;li&gt;网络：待测试&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;架构&lt;/h2&gt;
&lt;h3 id=&quot;前端&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%8D%E7%AB%AF&quot; aria-label=&quot;前端 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;前端&lt;/h3&gt;
&lt;p&gt;平衡团队的技术栈和我们的需求，
我们选择在 &lt;a href=&quot;https://github.com/suxb201/Learning-and-Practicing&quot;&gt;VuePress 1.x&lt;/a&gt; 基础上开发镜像站的前端。
给予 VuePress 方便使用 Vue 扩展功能，其默认主题满足镜像站需求，MarkDown 文档表现较佳。&lt;/p&gt;
&lt;h3 id=&quot;后端&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%90%8E%E7%AB%AF&quot; aria-label=&quot;后端 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;后端&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;BackendConfigJournal.html&quot;&gt;后端配置记录&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;山东大学镜像站团队&lt;br&gt;
2019.4.21&lt;/p&gt;</content:encoded></item><item><title><![CDATA[镜像站服务器更换记录]]></title><description><![CDATA[未完待续]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/blog/ServerMigration/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/blog/ServerMigration/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;未完待续&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Arch Linux 镜像源使用说明]]></title><description><![CDATA[编辑 ，改为以下内容： 可在 root 权限下使用以下命令直接设置。 使用以下命令更新系统，这会同时更新 pacman 数据库和安装的软件。 提示 注：由于 Arch Linux 本身的包管理设计，Arch Linux…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/ArchLinux/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/ArchLinux/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;编辑 &lt;code class=&quot;language-text&quot;&gt;/etc/pacman.d/mirrorlist&lt;/code&gt;，改为以下内容：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Server&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; https://mirrors.sdu.edu.cn/archlinux/$repo/os/$arch &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可在 root 权限下使用以下命令直接设置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Server = https://mirrors.sdu.edu.cn/archlinux/&lt;span class=&quot;token variable&quot;&gt;$repo&lt;/span&gt;/os/&lt;span class=&quot;token variable&quot;&gt;$arch&lt;/span&gt;&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /etc/pacman.d/mirrorlist&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用以下命令更新系统，这会同时更新 pacman 数据库和安装的软件。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pacman -Syu&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;提示&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8F%90%E7%A4%BA&quot; aria-label=&quot;提示 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;提示&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;注：由于 Arch Linux 本身的包管理设计，Arch Linux 不保证软件包更新的稳定性，因此我们提供了以下提示。这些提示并不代表镜像站本身存在问题。&lt;/li&gt;
&lt;li&gt;Arch Linux 是滚动更新的 Linux 发行版，请尽可能频繁地更新系统。如果间隔太长时间没有更新系统，在更新系统时可能出现 &lt;code class=&quot;language-text&quot;&gt;Import PGP key&lt;/code&gt; 的提示，一般是由于之前信任的 GPG 公钥的过期时间已到，自动失效。请按 &lt;code class=&quot;language-text&quot;&gt;Ctrl+C&lt;/code&gt; 中止 pacman，并使用 &lt;code class=&quot;language-text&quot;&gt;pacman -S archlinux-keyring&lt;/code&gt; 命令重新导入信任的公钥列表。如果依然存在问题，可考虑&lt;a href=&quot;https://wiki.archlinux.org/index.php/Pacman/Package_signing#Resetting_all_the_keys&quot;&gt;重置所有公钥&lt;/a&gt;或者暂时&lt;a href=&quot;https://wiki.archlinux.org/index.php/Pacman/Package_signing#Disabling_signature_checking&quot;&gt;禁用签名检查&lt;/a&gt;，并在升级成功后重新启用签名检查。&lt;/li&gt;
&lt;li&gt;由于不同镜像站的更新进度不一样，为最大程度保证 Arch Linux 的稳定性，切换镜像站之前，建议先搁置一两天不要更新，然后再切换镜像站并更新系统。否则，在更换镜像站后，在使用 &lt;code class=&quot;language-text&quot;&gt;pacman -Syu&lt;/code&gt; 更新系统时可能会出现 HTTP 404 问题，此时可使用 &lt;code class=&quot;language-text&quot;&gt;pacman -Syyu&lt;/code&gt; 命令强制更新数据库。如果依然存在问题，可考虑使用 &lt;code class=&quot;language-text&quot;&gt;pacman -Syyuu&lt;/code&gt; 命令降级。注意，最后两条命令都是比较危险的，应慎重考虑后再使用。&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[校内用户必看：DNS 问题]]></title><description><![CDATA[山东大学镜像站现阶段采用了类似于 NAT 转发的方式为山东大学校园网以外的用户提供服务。因此同时使用了两个 IPv4 地址，即只能在山东大学校园网内访问的  及只能在山东大学校园网外访问的 。本站采取的权宜之计是，配置校内 DNS 将  解析到 ；配置校外 DNS…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/DNSIssue/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/DNSIssue/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;山东大学镜像站现阶段采用了类似于 NAT 转发的方式为山东大学校园网以外的用户提供服务。因此同时使用了两个 IPv4 地址，即只能在山东大学校园网内访问的 &lt;code class=&quot;language-text&quot;&gt;10.102.32.195&lt;/code&gt; 及只能在山东大学校园网外访问的 &lt;code class=&quot;language-text&quot;&gt;101.76.224.14&lt;/code&gt;。本站采取的权宜之计是，配置校内 DNS 将 &lt;code class=&quot;language-text&quot;&gt;mirrors.sdu.edu.cn&lt;/code&gt; 解析到 &lt;code class=&quot;language-text&quot;&gt;10.102.32.195&lt;/code&gt;；配置校外 DNS 将 &lt;code class=&quot;language-text&quot;&gt;mirrors.sdu.edu.cn&lt;/code&gt; 解析到 &lt;code class=&quot;language-text&quot;&gt;101.76.224.14&lt;/code&gt;。在大多数情况下，可保证校内用户成功访问山东大学镜像站，但以下情况可能会导致校内用户被解析到校外 IPv4 地址，造成无法正常访问：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用户不使用学校提供的 DNS 服务器，将本地 DNS 服务器设置为了其他 DNS 服务器。&lt;/li&gt;
&lt;li&gt;随着 DoH 服务的流行，操作系统、浏览器可能自动开启了 DoH 功能。&lt;/li&gt;
&lt;li&gt;用户主动使用了诸如 DoH、DoT、DNSCrypt 等安全 DNS 服务。&lt;/li&gt;
&lt;li&gt;用户正在使用网络代理，代理软件接管了 DNS 解析。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们将继续积极推动山东大学镜像站的网络建设，争取早日解决 IPv4 问题、支持 IPv6 地址，向用户提供更好的服务。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Debian 镜像源使用说明]]></title><description><![CDATA[受镜像站硬盘容量限制，只对部分内容进行了同步。 支持的指令集：仅 amd64。 支持的版本：仅 buster。 仅二进制包，不包含源码。 Debian 10 Debian 10 (buster) 用户请将  文件改为以下内容： 一点小提示 debian-security…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/Debian/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/Debian/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;受镜像站硬盘容量限制，只对部分内容进行了同步。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;支持的指令集：仅 amd64。&lt;/li&gt;
&lt;li&gt;支持的版本：仅 buster。&lt;/li&gt;
&lt;li&gt;仅二进制包，不包含源码。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;debian-10&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#debian-10&quot; aria-label=&quot;debian 10 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Debian 10&lt;/h2&gt;
&lt;p&gt;Debian 10 (buster) 用户请将 &lt;code class=&quot;language-text&quot;&gt;/etc/apt/sources.list&lt;/code&gt; 文件改为以下内容：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;deb https://mirrors.sdu.edu.cn/debian buster main contrib non-free
deb https://mirrors.sdu.edu.cn/debian-security buster/updates main contrib non-free
deb https://mirrors.sdu.edu.cn/debian buster-updates main contrib non-free&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;一点小提示&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%80%E7%82%B9%E5%B0%8F%E6%8F%90%E7%A4%BA&quot; aria-label=&quot;一点小提示 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;一点小提示&lt;/h2&gt;
&lt;p&gt;debian-security 的 buster/updates 提供了重要的安全更新。类比于 ubuntu 中的 bionic-security。&lt;/p&gt;
&lt;p&gt;debian 的 buster-updates 提前提供下一个更新点的部分软件更新，如病毒扫描程序和时区数据等。类比于 ubuntu 中的 bionic-updates。&lt;/p&gt;
&lt;p&gt;对于精简安装的 Debian，apt-get 工具不一定能够支持 https。使用如下命令安装依赖包。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; apt-transport-https ca-certificates&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Rocky Linux 镜像源使用说明]]></title><description><![CDATA[本镜像是 Tier 1 Mirror，每日从官方主节点同步一次。 镜像源更换步骤如下。 将所有的官方主镜像地址替换为山东大学镜像站地址。 注，若之前已经将镜像源替换为了其他镜像站，现在想要切换到山东大学镜像站，请参考  中的 repo…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/RockyLinux/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/RockyLinux/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;本镜像是 Tier 1 Mirror，每日从官方主节点同步一次。&lt;/p&gt;
&lt;p&gt;镜像源更换步骤如下。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将所有的官方主镜像地址替换为山东大学镜像站地址。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;s|^mirrorlist=|#mirrorlist=|g&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -e &lt;span class=&quot;token string&quot;&gt;&apos;s|^#baseurl=http://dl.rockylinux.org/&lt;span class=&quot;token variable&quot;&gt;$contentdir&lt;/span&gt;|baseurl=https://mirrors.sdu.edu.cn/rocky|g&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -i.bak &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    /etc/yum.repos.d/Rocky-*.repo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注，若之前已经将镜像源替换为了其他镜像站，现在想要切换到山东大学镜像站，请参考 &lt;code class=&quot;language-text&quot;&gt;/etc/yum.repos.d/&lt;/code&gt; 中的 repo 文件，将上述命令中的 &lt;code class=&quot;language-text&quot;&gt;#baseurl&lt;/code&gt; 部分替换为 &lt;code class=&quot;language-text&quot;&gt;baseurl&lt;/code&gt;，再将 &lt;code class=&quot;language-text&quot;&gt;http://dl.rockylinux.org/$contentdir&lt;/code&gt; 部分替换为对应镜像站的地址。&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;更新缓存。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;dnf makecache&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[校内用户必看：路由器关闭 Rebind Protection]]></title><description><![CDATA[什么是 Rebind Protection，为什么要关闭它？ dnsmasq 提供了名为 rebind protection 的功能，意思是，当上游 DNS 返回了私有 IP 解析结果时，认为遭到了 DNS 劫持，从而拒绝此结果，以 NXDOMAIN…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/TurnOffRebindProtection/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/TurnOffRebindProtection/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;h2 id=&quot;什么是-rebind-protection，为什么要关闭它？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AF-rebind-protection%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%85%B3%E9%97%AD%E5%AE%83%EF%BC%9F&quot; aria-label=&quot;什么是 rebind protection，为什么要关闭它？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是 Rebind Protection，为什么要关闭它？&lt;/h2&gt;
&lt;p&gt;dnsmasq 提供了名为 rebind protection 的功能，意思是，当上游 DNS 返回了私有 IP 解析结果时，认为遭到了 DNS 劫持，从而拒绝此结果，以 NXDOMAIN 取代之。
然而，山东大学的校园网已经将私有 IPv4 网段作为了校园网的一部分，&lt;code class=&quot;language-text&quot;&gt;10.0.0.0/8&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;172.16.0.0/12&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;192.168.0.0/16&lt;/code&gt; 均被使用，以前两者尤甚。本镜像站所用服务器也使用了内网地址。因此，对应域名的 A 记录不可避免地要设置为私有 IP。
dnsmasq 默认不开启 rebind protection 功能，但官方版本的 OpenWRT 默认开启。如果你的路由器是基于 OpenWRT 的发行版，则需要手动关闭此功能。&lt;/p&gt;
&lt;p&gt;注意，我们仅推荐在山东大学校园网环境下关闭此功能。对于其他网络环境，应具体情况具体分析。&lt;/p&gt;
&lt;h2 id=&quot;如何确定是否需要关闭此功能？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E5%85%B3%E9%97%AD%E6%AD%A4%E5%8A%9F%E8%83%BD%EF%BC%9F&quot; aria-label=&quot;如何确定是否需要关闭此功能？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何确定是否需要关闭此功能？&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;在山东大学校园网环境下，如果出现浏览器不能访问 &lt;code class=&quot;language-text&quot;&gt;mirrors.sdu.edu.cn&lt;/code&gt; ，但可以访问 &lt;code class=&quot;language-text&quot;&gt;10.102.32.195&lt;/code&gt;（即前述域名对应的 A 记录）的情况，则表示当前 rebind protection 已经开启，需要关闭此功能。&lt;/li&gt;
&lt;li&gt;在山东大学校园网环境下，使用 &lt;code class=&quot;language-text&quot;&gt;nslookup&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;dig&lt;/code&gt; 等工具取得 &lt;code class=&quot;language-text&quot;&gt;mirrors.sdu.edu.cn&lt;/code&gt; 的 A 记录，结果为空，也表示当前 rebind protection 已经开启，需要关闭此功能。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;如何关闭此功能？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%AD%E6%AD%A4%E5%8A%9F%E8%83%BD%EF%BC%9F&quot; aria-label=&quot;如何关闭此功能？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何关闭此功能？&lt;/h2&gt;
&lt;p&gt;对于官方版本的 OpenWRT，可参考下图。即，选择 &lt;code class=&quot;language-text&quot;&gt;网络&lt;/code&gt; → &lt;code class=&quot;language-text&quot;&gt;DHCP/DNS&lt;/code&gt;  菜单，找到 &lt;code class=&quot;language-text&quot;&gt;重绑定保护&lt;/code&gt;，取消勾选这个选项。最后，别忘了点击 &lt;code class=&quot;language-text&quot;&gt;保存&amp;amp;应用&lt;/code&gt; 按钮。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/docs/static/0fe441f6135cdd5849df5cbb6d801331/5a190/TurnOffRebindProtection-pic-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABJ0AAASdAHeZh94AAACAUlEQVQoz4WRvW/TQBiH/a8EGInVDMBUhjTlIyrFThoBgnSgS2YmVv4ChjKwMGWhZWZBaiPq5sOxIjfho1Vi5FBI09iO3Zx98Z2/DsW2yFARHr3S3Unvo/f96ahXHzsHbflb92en2//aO21L5/Xvg8bJkA9LlHVR1uvH543js3b/4qhviLLeOBntdZRPXxTqUT7PsuxGocAw7NNnRWbj8YP8kztrudUss5plMlkmc/9hVCv31lfurmfWmOLLUuHF5ut3b6mmIPB8UzwS32xv0zSdWqKvXb2SY5la9bDKcdzB51r1UGg25yU0W6LAt+o9qUsRQnzfJ4TUarUbN28xbC5J08+3tsj/sG2b8jzPcRxCSKVSWV6+nU6nk8nrpVIJQghM07IsCKFlhsfsFmMjNBwO55M5jqOTdCq1lEgkiptFVVU0TbNtG4XgEISQPWPqOG4sR0iStLOz+373Q7lc3t/fQxjb0ymybdd1nRCMsed5YW9ACIEQxnIwww8Icf34OQ2JB4VAaEUBIzDGc3mWCMKJBVHY/XfVKNRlEEJUpEYCRtiYAEPXLwwDmABacAKA67kLZUKw5yLHwZ6vW1Aba5quAwBM0xzrYwjhItkfKaBaB7xg8oLVEklPCn7IAULBwn+O5QBjV1UdVcWKdib/1gaD0ekvfTw2DGM0UhDC/5L/AK/ElNgfEIEkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;TurnOffRebindProtection pic 1&quot;
        title=&quot;TurnOffRebindProtection pic 1&quot;
        src=&quot;/docs/static/0fe441f6135cdd5849df5cbb6d801331/f058b/TurnOffRebindProtection-pic-1.png&quot;
        srcset=&quot;/docs/static/0fe441f6135cdd5849df5cbb6d801331/c26ae/TurnOffRebindProtection-pic-1.png 158w,
/docs/static/0fe441f6135cdd5849df5cbb6d801331/6bdcf/TurnOffRebindProtection-pic-1.png 315w,
/docs/static/0fe441f6135cdd5849df5cbb6d801331/f058b/TurnOffRebindProtection-pic-1.png 630w,
/docs/static/0fe441f6135cdd5849df5cbb6d801331/5a190/TurnOffRebindProtection-pic-1.png 800w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;一般而言，到此就结束了。&lt;/p&gt;
&lt;h2 id=&quot;提示&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8F%90%E7%A4%BA&quot; aria-label=&quot;提示 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;提示&lt;/h2&gt;
&lt;p&gt;如果路由器并未使用官方版本的 OpenWRT，也无法从设置界面中找到类似的设置，则可能无法从 Web 界面完成这个操作。此时，可以通过 SSH 连接到路由器，然后使用 &lt;code class=&quot;language-text&quot;&gt;uci&lt;/code&gt; 命令或者修改 &lt;code class=&quot;language-text&quot;&gt;/etc/config/dhcp&lt;/code&gt; 文件来达到目标。&lt;/p&gt;
&lt;p&gt;如果依然无法完成此操作，或者路由器并不基于 OpenWRT，但依然存在 rebind protection 问题，可将电脑端的 DNS 设置为非路由器 DNS 来直接绕过 rebind protection。注意，并非所有路由器都会允许底下的设备走第三方 DNS，有些路由器会通过 DNS 劫持的手段强制返回路由器 DNS 的结果。&lt;/p&gt;
&lt;p&gt;如果依然无法完成此操作，可考虑直接连接到山东大学校园网。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Ubuntu 镜像源使用说明]]></title><description><![CDATA[受镜像站硬盘容量限制，只对部分内容进行了同步。 支持的版本：focal、bionic 和 xenial。 支持的指令集：amd64、i386。 仅二进制包，不包含源码。 Ubuntu 20.04 LTS Ubuntu 20.04 LTS (focal…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/Ubuntu/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/Ubuntu/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;受镜像站硬盘容量限制，只对部分内容进行了同步。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;支持的版本：focal、bionic 和 xenial。&lt;/li&gt;
&lt;li&gt;支持的指令集：amd64、i386。&lt;/li&gt;
&lt;li&gt;仅二进制包，不包含源码。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ubuntu-2004-lts&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ubuntu-2004-lts&quot; aria-label=&quot;ubuntu 2004 lts permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ubuntu 20.04 LTS&lt;/h2&gt;
&lt;p&gt;Ubuntu 20.04 LTS (focal) 用户请将 &lt;code class=&quot;language-text&quot;&gt;/etc/apt/sources.list&lt;/code&gt; 文件改为以下内容：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;deb https://mirrors.sdu.edu.cn/ubuntu/ focal main restricted universe multiverse
deb https://mirrors.sdu.edu.cn/ubuntu/ focal-security main restricted universe multiverse
deb https://mirrors.sdu.edu.cn/ubuntu/ focal-updates main restricted universe multiverse&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;支持的指令集：amd64、i386。&lt;/p&gt;
&lt;h2 id=&quot;ubuntu-1804-lts&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ubuntu-1804-lts&quot; aria-label=&quot;ubuntu 1804 lts permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ubuntu 18.04 LTS&lt;/h2&gt;
&lt;p&gt;Ubuntu 18.04 LTS (bionic) 用户请将 &lt;code class=&quot;language-text&quot;&gt;/etc/apt/sources.list&lt;/code&gt; 文件改为以下内容：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;deb https://mirrors.sdu.edu.cn/ubuntu/ bionic main restricted universe multiverse
deb https://mirrors.sdu.edu.cn/ubuntu/ bionic-security main restricted universe multiverse
deb https://mirrors.sdu.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;支持的指令集：amd64、i386。&lt;/p&gt;
&lt;h2 id=&quot;ubuntu-1604-lts&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ubuntu-1604-lts&quot; aria-label=&quot;ubuntu 1604 lts permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ubuntu 16.04 LTS&lt;/h2&gt;
&lt;p&gt;Ubuntu 16.04 LTS (xenial) 用户请将 &lt;code class=&quot;language-text&quot;&gt;/etc/apt/sources.list&lt;/code&gt; 文件改为以下内容：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;deb https://mirrors.sdu.edu.cn/ubuntu/ xenial main restricted universe multiverse
deb https://mirrors.sdu.edu.cn/ubuntu/ xenial-security main restricted universe multiverse
deb https://mirrors.sdu.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;支持的指令集：amd64、i386。&lt;/p&gt;
&lt;h2 id=&quot;强迫症选项&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BC%BA%E8%BF%AB%E7%97%87%E9%80%89%E9%A1%B9&quot; aria-label=&quot;强迫症选项 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;强迫症选项&lt;/h2&gt;
&lt;p&gt;桌面版 Ubuntu 在主要使用 amd64 架构的同时，默认也同时支持了 i386 架构，用于支持 Steam 等软件的正常运行。如果希望彻底抛弃 i386 架构，可按以下步骤进行。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;搜索并删除所有 i386 的软件包。不过，默认情况下，应该没有 i386 软件包。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; remove --purge &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;dpkg --get-selections &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/i386/{print &lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt;}&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;移除对 i386 架构的支持。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;dpkg --remove-architecture i386&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;snap-仓库&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#snap-%E4%BB%93%E5%BA%93&quot; aria-label=&quot;snap 仓库 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Snap 仓库&lt;/h2&gt;
&lt;p&gt;目前，互联网上不存在针对 Ubuntu Snap 应用商店的镜像，因此请尽量使用 &lt;code class=&quot;language-text&quot;&gt;apt&lt;/code&gt; 命令，而非图形界面的 Ubuntu 应用商店或者 &lt;code class=&quot;language-text&quot;&gt;snap&lt;/code&gt; 命令，以避免下载速度慢甚至无法下载的情况。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Windows 安装指南]]></title><description><![CDATA[请根据电脑的正版授权情况，从 、 和  中选择正确的版本，否则安装成功后将无法激活。如果不确定需要哪个版本，请选择 Business 版本，并通过山东大学正版软件管理平台完成正版激活。 Windows 10 半年频道 Windows 10 Business…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/Windows-iso/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/Windows-iso/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;请根据电脑的正版授权情况，从 &lt;code class=&quot;language-text&quot;&gt;Business&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Customer&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;China Get Genuine&lt;/code&gt; 中选择正确的版本，否则安装成功后将无法激活。如果不确定需要哪个版本，请选择 Business 版本，并通过&lt;a href=&quot;http://softms.sdu.edu.cn&quot;&gt;山东大学正版软件管理平台&lt;/a&gt;完成正版激活。&lt;/p&gt;
&lt;h2 id=&quot;windows-10-半年频道&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windows-10-%E5%8D%8A%E5%B9%B4%E9%A2%91%E9%81%93&quot; aria-label=&quot;windows 10 半年频道 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Windows 10 半年频道&lt;/h2&gt;
&lt;h3 id=&quot;windows-10-business&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windows-10-business&quot; aria-label=&quot;windows 10 business permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Windows 10 Business&lt;/h3&gt;
&lt;p&gt;如果您的电脑通过&lt;a href=&quot;http://softms.sdu.edu.cn&quot;&gt;山东大学正版软件管理平台&lt;/a&gt;授权，可选择此版本，并运行平台提供的程序以完成激活。&lt;/p&gt;
&lt;h4 id=&quot;包含的版本&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8C%85%E5%90%AB%E7%9A%84%E7%89%88%E6%9C%AC&quot; aria-label=&quot;包含的版本 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;包含的版本&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 教育版 (批量授权版)&lt;/li&gt;
&lt;li&gt;Windows 10 企业版 (批量授权版)&lt;/li&gt;
&lt;li&gt;Windows 10 专业版 (批量授权版)&lt;/li&gt;
&lt;li&gt;Windows 10 专业教育版 (批量授权版)&lt;/li&gt;
&lt;li&gt;Windows 10 专业工作站版 (批量授权版)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;下载&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8B%E8%BD%BD&quot; aria-label=&quot;下载 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;下载&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;校内：&lt;a href=&quot;https://ftp.oops-sdu.cn/mirrors/windows-iso/Business/&quot;&gt;https://ftp.oops-sdu.cn/mirrors/windows-iso/Business/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;windows-10-consumer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windows-10-consumer&quot; aria-label=&quot;windows 10 consumer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Windows 10 Consumer&lt;/h3&gt;
&lt;p&gt;如果您的电脑通过“Windows 10 易升”从 Windows 8 升级到 Windows 10，请选择此版本，无需输入序列号，联网即可识别为正版。&lt;/p&gt;
&lt;h4 id=&quot;包含的版本-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8C%85%E5%90%AB%E7%9A%84%E7%89%88%E6%9C%AC-1&quot; aria-label=&quot;包含的版本 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;包含的版本&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 家庭版 (零售版)&lt;/li&gt;
&lt;li&gt;Windows 10 家庭单语言版 (零售版)&lt;/li&gt;
&lt;li&gt;Windows 10 教育版 (零售版)&lt;/li&gt;
&lt;li&gt;Windows 10 专业版 (零售版)&lt;/li&gt;
&lt;li&gt;Windows 10 专业教育版 (零售版)&lt;/li&gt;
&lt;li&gt;Windows 10 专业工作站版 (零售版)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;下载-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8B%E8%BD%BD-1&quot; aria-label=&quot;下载 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;下载&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;校内：&lt;a href=&quot;https://ftp.oops-sdu.cn/mirrors/windows-iso/Consumer/&quot;&gt;https://ftp.oops-sdu.cn/mirrors/windows-iso/Consumer/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;微软官方下载：使用&lt;strong&gt;除 Windows 以外的&lt;/strong&gt;设备打开 &lt;a href=&quot;https://www.microsoft.com/zh-cn/software-download/windows10ISO/&quot;&gt;下载 Windows 10 光盘映像（ISO 文件）&lt;/a&gt; 页面，以便下载 ISO 文件。如不需要 ISO 文件，也可使用 &lt;strong&gt;Windows&lt;/strong&gt; 设备打开此页面，以便下载更友好的安装工具。请在“版本选择”中选择 “Windows 10”。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;windows-10-china-get-genuine&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windows-10-china-get-genuine&quot; aria-label=&quot;windows 10 china get genuine permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Windows 10 China Get Genuine&lt;/h3&gt;
&lt;p&gt;如果您的电脑在中国大陆销售，且由 OEM 预装了正版的 Windows 10，请选择此版本，无需输入序列号，联网即可识别为正版。&lt;/p&gt;
&lt;h4 id=&quot;包含的版本-2&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8C%85%E5%90%AB%E7%9A%84%E7%89%88%E6%9C%AC-2&quot; aria-label=&quot;包含的版本 2 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;包含的版本&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 家庭中文版 (OEM 版)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;下载-2&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8B%E8%BD%BD-2&quot; aria-label=&quot;下载 2 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;下载&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;校内：&lt;a href=&quot;https://ftp.oops-sdu.cn/mirrors/windows-iso/China/&quot;&gt;https://ftp.oops-sdu.cn/mirrors/windows-iso/China/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;微软官方下载：使用&lt;strong&gt;除 Windows 以外的&lt;/strong&gt;设备打开 &lt;a href=&quot;https://www.microsoft.com/zh-cn/software-download/windows10ISO/&quot;&gt;下载 Windows 10 光盘映像（ISO 文件）&lt;/a&gt; 页面，以便下载 ISO 文件。如不需要 ISO 文件，也可使用 &lt;strong&gt;Windows&lt;/strong&gt; 设备打开此页面，以便下载更友好的安装工具。请在“版本选择”中选择 “Windows 10 家庭中文版”。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;windows-10-长期服务分支&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windows-10-%E9%95%BF%E6%9C%9F%E6%9C%8D%E5%8A%A1%E5%88%86%E6%94%AF&quot; aria-label=&quot;windows 10 长期服务分支 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Windows 10 长期服务分支&lt;/h2&gt;
&lt;h3 id=&quot;windows-10-enterprise-ltsc-2019&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windows-10-enterprise-ltsc-2019&quot; aria-label=&quot;windows 10 enterprise ltsc 2019 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Windows 10 Enterprise LTSC 2019&lt;/h3&gt;
&lt;p&gt;如果您的电脑通过&lt;a href=&quot;http://softms.sdu.edu.cn&quot;&gt;山东大学正版软件管理平台&lt;/a&gt;授权，可选择此版本，并运行平台提供的程序以完成激活。不过，截至目前（2020年5月），由于山东大学的 KMS 服务器所在 Windows Server 并未更新到最新版本，不包含 LTSB/LTSC 版本的激活信息，可能无法成功激活。&lt;/p&gt;
&lt;h4 id=&quot;更新日期&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F&quot; aria-label=&quot;更新日期 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;更新日期&lt;/h4&gt;
&lt;p&gt;2018年10月&lt;/p&gt;
&lt;h4 id=&quot;包含的版本-3&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8C%85%E5%90%AB%E7%9A%84%E7%89%88%E6%9C%AC-3&quot; aria-label=&quot;包含的版本 3 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;包含的版本&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 企业版 LTSC 2019&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;下载-3&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8B%E8%BD%BD-3&quot; aria-label=&quot;下载 3 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;下载&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;校内：&lt;a href=&quot;https://ftp.oops-sdu.cn/mirrors/windows-iso/LTSC/&quot;&gt;https://ftp.oops-sdu.cn/mirrors/windows-iso/LTSC/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;windows-10-enterprise-ltsb-2016&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windows-10-enterprise-ltsb-2016&quot; aria-label=&quot;windows 10 enterprise ltsb 2016 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Windows 10 Enterprise LTSB 2016&lt;/h3&gt;
&lt;p&gt;如果您的电脑通过&lt;a href=&quot;http://softms.sdu.edu.cn&quot;&gt;山东大学正版软件管理平台&lt;/a&gt;授权，可选择此版本，并运行平台提供的程序以完成激活。不过，截至目前（2020年5月），由于山东大学的 KMS 服务器所在 Windows Server 并未更新到最新版本，不包含 LTSB/LTSC 版本的激活信息，可能无法成功激活。&lt;/p&gt;
&lt;h4 id=&quot;更新日期-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F-1&quot; aria-label=&quot;更新日期 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;更新日期&lt;/h4&gt;
&lt;p&gt;2016年7月&lt;/p&gt;
&lt;h4 id=&quot;包含的版本-4&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8C%85%E5%90%AB%E7%9A%84%E7%89%88%E6%9C%AC-4&quot; aria-label=&quot;包含的版本 4 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;包含的版本&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 企业版 LTSB 2016&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;下载-4&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8B%E8%BD%BD-4&quot; aria-label=&quot;下载 4 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;下载&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;校内：&lt;a href=&quot;https://ftp.oops-sdu.cn/mirrors/windows-iso/LTSC/&quot;&gt;https://ftp.oops-sdu.cn/mirrors/windows-iso/LTSC/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;微pe工具箱&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%BE%AEpe%E5%B7%A5%E5%85%B7%E7%AE%B1&quot; aria-label=&quot;微pe工具箱 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;微PE工具箱&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;官网地址: &lt;a href=&quot;http://www.wepe.com.cn/&quot;&gt;www.wepe.com.cn&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;校内下载: &lt;a href=&quot;https://ftp.oops-sdu.cn/mirrors/windows-iso/WePE/&quot;&gt;https://ftp.oops-sdu.cn/mirrors/windows-iso/WePE/&lt;/a&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;常见问题-faq&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-faq&quot; aria-label=&quot;常见问题 faq permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;常见问题 FAQ&lt;/h2&gt;
&lt;h3 id=&quot;a-namefaq-how-to-installa1-如何安装-windows，以及注意事项？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-namefaq-how-to-installa1-%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85-windows%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9F&quot; aria-label=&quot;a namefaq how to installa1 如何安装 windows，以及注意事项？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a name=&quot;faq-how-to-install&quot;&gt;&lt;/a&gt;1. 如何安装 Windows，以及注意事项？&lt;/h3&gt;
&lt;p&gt;如果您对 Windows 不熟悉，以下是我们推荐的安装步骤。该安装步骤强调“最佳实践”，即不使用老旧的技术，尽可能规避旧方案的弊端。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;进入电脑的 BIOS 设置界面，将 CSM 关闭，将 Boot mode 设置为 UEFI only。依主板型号不同，设置界面可能有较大差别，但通常可以在“Boot”页面下找到。&lt;/li&gt;
&lt;li&gt;下载“微PE工具箱”并用它制作一个可启动 U 盘。&lt;/li&gt;
&lt;li&gt;用该 U 盘启动电脑。依电脑型号不同，可能需要在开机时频繁按 F2/F7/F8/F9/F11/F12/DEL/ESC 等键才能调出启动菜单，如果是笔记本电脑可能还需要按住/不按住 Fn 键。部分电脑还需要将 Fast boot 选项禁用。具体请参考对应电脑或主板说明书。&lt;/li&gt;
&lt;li&gt;如果硬盘不是 GUID 分区表（GPT），使用 &lt;code class=&quot;language-text&quot;&gt;傲梅分区助手&lt;/code&gt; 将硬盘转换为 GUID 分区表（GPT）。直到所有硬盘都被转换为 GUID 分区表（GPT）为止。&lt;/li&gt;
&lt;li&gt;打开 &lt;code class=&quot;language-text&quot;&gt;Diskgenius&lt;/code&gt;。为了接下来操作方便，可将系统分区（C 盘）删除。也可不删除，视后续步骤而定。&lt;/li&gt;
&lt;li&gt;检查系统所在硬盘是否存在 &lt;code class=&quot;language-text&quot;&gt;EFI 系统分区&lt;/code&gt;（ESP）。如果没有，新建一个 &lt;code class=&quot;language-text&quot;&gt;EFI 系统分区&lt;/code&gt;，大小可取 512 MiB，文件系统 FAT32。&lt;/li&gt;
&lt;li&gt;按 Windows 的要求，在 &lt;code class=&quot;language-text&quot;&gt;EFI 系统分区&lt;/code&gt; 之后，第一个主分区之前，应该有一个 &lt;code class=&quot;language-text&quot;&gt;微软保留分区&lt;/code&gt;（MSR）。大小可取 512 MiB，无需关注文件系统。
尽量满足这一要求，但如果由于各种原因（如分区布局无法满足要求），无法创建 &lt;code class=&quot;language-text&quot;&gt;微软保留分区&lt;/code&gt;，可忽略此步。&lt;/li&gt;
&lt;li&gt;在 &lt;code class=&quot;language-text&quot;&gt;微软保留分区&lt;/code&gt; 的后面创建一个文件系统为 NTFS 的主分区，建议大小至少为 100 GiB，或者，如果这是一个 120GB/240GB 的固态硬盘，使用所有的空间。此分区将作为系统分区（C 盘）。如果之前没有删除原来的系统分区（C 盘），且分区布局满足要求，也可只将其格式化。&lt;/li&gt;
&lt;li&gt;如果其他分区还没有创建，可在此创建分区。注意，GUID 分区表下主分区的数量几乎没有限制，也没有扩展分区、逻辑分区这种极不合理、易丢失数据的糟糕设计。虽然如此，仅仅是从良好习惯的方面考虑，我们不提倡过多的分区数量，通常以 1 个数据分区为宜。使用文件夹来做好分类，而不是分区。&lt;/li&gt;
&lt;li&gt;打开 &lt;code class=&quot;language-text&quot;&gt;Windows 安装器&lt;/code&gt;（WinNTSetup），依次选择好 ISO 镜像、系统分区位置、&lt;code class=&quot;language-text&quot;&gt;EFI 系统分区&lt;/code&gt; 位置（软件可能会自动选择，也可能不会），然后选择合适的 Windows 版本，点击 &lt;code class=&quot;language-text&quot;&gt;开始安装&lt;/code&gt; 按钮即可。&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装结束后，建议将硬件时区设置为协调世界时，这可避免在与 Linux 共存时，切换系统会导致时间出错的问题。以管理员权限执行以下命令。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;reg &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation&quot;&lt;/span&gt; /v RealTimeIsUniversal /t REG_DWORD /d &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; /f&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;建议将 &lt;code class=&quot;language-text&quot;&gt;快速启动&lt;/code&gt; 功能关闭。时至今日，固态硬盘已经普及，&lt;code class=&quot;language-text&quot;&gt;快速启动&lt;/code&gt; 功能对启动时间的提升不明显，且会带来多系统切换麻烦、对 NTFS 分区读写争用的问题，建议关闭。以管理员权限执行以下命令。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;reg &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Power&quot;&lt;/span&gt; /v HiberbootEnabled /t REG_DWORD /d &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; /f&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;注: 为什么不推荐直接将 Windows 安装镜像写入 U 盘？
由于 install.wim 文件已经超过 4 GiB，使用 &lt;code class=&quot;language-text&quot;&gt;UltraISO&lt;/code&gt; 软件可能会将 U 盘格式化为 NTFS 格式，并不是所有主板都支持在上面启动，尤其是 UEFI 引导。使用 &lt;code class=&quot;language-text&quot;&gt;rufus&lt;/code&gt; 软件写入 U 盘会采用多分区方案来规避此限制，但需要主板关闭安全启动。
此外，Windows 的安装镜像并非 Hybrid ISO，因此你无法使用 &lt;code class=&quot;language-text&quot;&gt;dd&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;Win32DiskImager&lt;/code&gt; 将其写入 U 盘。&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[lxc-images 镜像源使用说明]]></title><description><![CDATA[lxc-images 仓库被 LXC 用于容器内操作系统的部署。截至目前（2019 年 12 月），中国大陆仅有 清华大学开源软件镜像站 这一个公网镜像，但此镜像存在严重的索引与内容不一致问题，因此不总是可用。山东大学镜像站对 lxc-images…]]></description><link>https://gatsbystarterblogsource.gatsbyjs.io/guide/lxc-images/</link><guid isPermaLink="false">https://gatsbystarterblogsource.gatsbyjs.io/guide/lxc-images/</guid><pubDate>Wed, 12 May 2021 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;lxc-images 仓库被 LXC 用于容器内操作系统的部署。截至目前（2019 年 12 月），中国大陆仅有 &lt;a href=&quot;https://mirrors.tuna.tsinghua.edu.cn/help/lxc-images/&quot;&gt;清华大学开源软件镜像站&lt;/a&gt; 这一个公网镜像，但此镜像存在严重的索引与内容不一致问题，因此不总是可用。山东大学镜像站对 lxc-images 做了镜像，严格保证索引与内容一致。lxc-images 仓库的性质决定了对一致性的要求远高于及时性，因此目前不保证此镜像与上游及时同步，也没有必要。&lt;/p&gt;
&lt;p&gt;注意，出于保证原子性和缩减大小的考虑，索引文件 index-system 及 index-user 经过了修改，且仅支持 amd64 指令集。lxc-create 的 download 模板默认校验数字签名，且对应的公钥固定在 download 模板中。如果我们使用不同的私钥重新签名，则只能对索引和内容全部重新签名，计算量较大。因此，索引文件对应的数字签名被直接去除。在使用 lxc-create 的 download 模板时，加入 &lt;code class=&quot;language-text&quot;&gt;--no-validate&lt;/code&gt; 以跳过校验。&lt;/p&gt;
&lt;h2 id=&quot;使用方式&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F&quot; aria-label=&quot;使用方式 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用方式&lt;/h2&gt;
&lt;p&gt;创建一个名为 &lt;code class=&quot;language-text&quot;&gt;NAME&lt;/code&gt; 的容器。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;lxc-create -n NAME -t download -- --server mirrors.sdu.edu.cn/lxc-images --no-validate&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>